---
id: rw_pre-building_test
title: Pre-Building Test Workflow
sidebar_position: 24
---

# Pre-Building Test Workflow

[![View Source](https://img.shields.io/badge/View-Source-blue?logo=github)](https://github.com/Chisanan232/GitHub-Action_Reusable_Workflows-Python/blob/master/.github/workflows/rw_pre-building_test.yaml)

Test package installation before deployment.

## Overview

This workflow validates that the built Python package can be installed and imported correctly before publishing to PyPI, preventing broken package deployments.

## When to Use

- ✅ You want to validate package installation
- ✅ You need to test package imports
- ✅ You're preparing for PyPI deployment
- ✅ You want to catch packaging errors early

## Inputs

| Input | Type | Default | Description |
|-------|------|---------|-------------|
| `package_path` | string | `'dist/'` | Path to built packages |
| `python_version` | string | `'3.11'` | Python version for testing |
| `test_import` | boolean | `true` | Test package import |
| `package_name` | string | `''` | Package name to import |

## Outputs

| Output | Description |
|--------|-------------|
| `installation_success` | Whether installation succeeded |
| `import_success` | Whether import test succeeded |

## Usage Examples

### Basic Usage

```yaml
jobs:
  build:
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_python_package.yaml@master

  test-install:
    needs: build
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_pre-building_test.yaml@master
    with:
      package_name: my_package
```

### Multi-Version Testing

```yaml
jobs:
  build:
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_python_package.yaml@master

  test-install-py311:
    needs: build
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_pre-building_test.yaml@master
    with:
      python_version: '3.11'
      package_name: my_package

  test-install-py312:
    needs: build
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_pre-building_test.yaml@master
    with:
      python_version: '3.12'
      package_name: my_package
```

### Complete Build and Deploy Pipeline

```yaml
jobs:
  build:
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_python_package.yaml@master

  test-install:
    needs: build
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_pre-building_test.yaml@master
    with:
      package_name: my_package

  publish:
    needs: test-install
    if: needs.test-install.outputs.installation_success == 'true'
    uses: Chisanan232/GitHub-Action_Reusable_Workflows-Python/.github/workflows/rw_push_pypi.yaml@master
    secrets:
      pypi_token: ${{ secrets.PYPI_API_TOKEN }}
```

## How It Works

### Step 1: Download Package

Downloads built package from artifacts:

```yaml
- uses: actions/download-artifact@v4
  with:
    name: python-package-distributions
    path: dist/
```

### Step 2: Install Package

Installs the wheel package:

```bash
pip install dist/*.whl
```

### Step 3: Test Import

Tests that package can be imported:

```python
import sys
try:
    import my_package
    print(f"Successfully imported {my_package.__name__}")
    print(f"Version: {my_package.__version__}")
    sys.exit(0)
except ImportError as e:
    print(f"Failed to import: {e}")
    sys.exit(1)
```

### Step 4: Validate Metadata

Checks package metadata:

```bash
pip show my-package
```

## Best Practices

### 1. Test All Supported Python Versions

```yaml
strategy:
  matrix:
    python-version: ['3.9', '3.10', '3.11', '3.12']
```

### 2. Test Both Wheel and Source Distribution

```yaml
- name: Test wheel installation
  run: pip install dist/*.whl

- name: Test sdist installation
  run: pip install dist/*.tar.gz
```

### 3. Validate Package Entry Points

```python
# Test CLI entry points
import subprocess
result = subprocess.run(['my-command', '--version'], capture_output=True)
assert result.returncode == 0
```

### 4. Check Dependencies

```bash
pip check  # Verify no dependency conflicts
```

## Troubleshooting

### Installation Fails

**Symptoms:**
- Package installation errors
- Dependency conflicts

**Solutions:**
1. Check package dependencies:
   ```toml
   [project]
   dependencies = [
       "requests>=2.28.0",
   ]
   ```

2. Verify package structure
3. Test locally:
   ```bash
   pip install dist/*.whl
   ```

### Import Fails

**Symptoms:**
- ImportError after installation
- Module not found

**Solutions:**
1. Verify package name matches:
   ```python
   import my_package  # Must match package name
   ```

2. Check package structure:
   ```
   src/
   └── my_package/
       └── __init__.py
   ```

3. Ensure `__init__.py` exists

## Related Workflows

- [rw_python_package](rw_python_package.mdx) - Build packages
- [rw_push_pypi](rw_push_pypi.mdx) - Publish to PyPI
- [rw_checking_deployment_state](rw_checking_deployment_state.mdx) - Check deployment
